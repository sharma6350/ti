(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{80076:(e,a,t)=>{Promise.resolve().then(t.bind(t,89397))},89397:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>ec});var s=t(95155),l=t(12115),r=t(97003),n=t(83209),i=t(84926),c=t(403),d=t(65229),o=t(91456),m=t(20508),h=t(91169),u=t(11010),x=t(85871),j=t(46701),f=t(52025),p=t(12203),g=t(97415),v=t(4246),N=t(33789),b=t(28171),y=t(39867),w=t(6191),S=t(46046),A=t(78874),C=t(71360),k=t(96633);function E(){let[e,a]=(0,l.useState)([]),[t,n]=(0,l.useState)(null),[i,c]=(0,l.useState)({}),d=(0,l.useRef)(null),{toast:o}=(0,b.dj)(),[m,h]=(0,l.useState)(null),x=e=>m?"".concat(m,"-").concat(e):null;(0,l.useEffect)(()=>{h(localStorage.getItem("schoolID"))},[]),(0,l.useEffect)(()=>{if(m)try{let e=x("teacherData");if(!e)return;let t=localStorage.getItem(e);if(t){let e=JSON.parse(t).map((e,a)=>({...e,id:a+1}));a(e)}else a([])}catch(a){console.error("Failed to load or parse teacher data from localStorage",a);let e=x("teacherData");e&&localStorage.removeItem(e)}},[m]);let j=e=>{let t=x("teacherData");if(!t)return;let s=e.map(e=>{let{id:a,...t}=e;return t});localStorage.setItem(t,JSON.stringify(s)),a(e)},f=()=>{let s=e.find(e=>e.id===t);(null==s?void 0:s.Name)==="New Teacher"&&(null==s?void 0:s.Subjects)==="Subjects"&&a(e.filter(e=>e.id!==t)),n(null),c({})},p=()=>{if(!i.Name||!i.Subjects||""===i.Name.trim()||""===i.Subjects.trim())return void o({title:"Fields cannot be empty",variant:"destructive"});j(e.map(e=>e.id===t?{...e,...i}:e)),n(null),c({}),o({title:"Teacher data saved."})},g=(e,a)=>{c(t=>({...t,[a]:e.target.value}))};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,s.jsx)(N.p,{type:"file",ref:d,accept:".xlsx, .xls",className:"flex-grow"}),(0,s.jsx)(r.$,{onClick:()=>{var e,t;let s=null==(t=d.current)||null==(e=t.files)?void 0:e[0];if(!s)return void o({title:"No file selected",description:"Please select an Excel file to upload.",variant:"destructive"});let l=new FileReader;l.onload=e=>{try{var t;if(!(null==(t=e.target)?void 0:t.result))throw Error("File could not be read.");let a=new Uint8Array(e.target.result),s=v.LF(a,{type:"array"}),l=s.SheetNames[0],r=s.Sheets[l];if(!r)throw Error('Sheet "'.concat(l,'" not found.'));let n=v.Wp.sheet_to_json(r);if(!Array.isArray(n)||0===n.length)throw Error("The Excel file seems to be empty or in the wrong format.");let i=n.map((e,a)=>({id:a+1,Name:String(e.Name||""),Subjects:String(e.Subjects||"")}));j(i),o({title:"Upload Successful",description:"Teacher data has been uploaded and stored."})}catch(t){a([]);let e=x("teacherData");e&&localStorage.removeItem(e),o({title:"Upload Failed",description:t.message||"There was an error parsing the Excel file.",variant:"destructive"})}},l.onerror=()=>{o({title:"File Read Error",description:"The selected file could not be read.",variant:"destructive"})},l.readAsArrayBuffer(s)},variant:"secondary",className:"w-full sm:w-auto",children:"Upload"}),(0,s.jsxs)(r.$,{onClick:()=>{let e=v.Wp.json_to_sheet([{Name:"Dr. Alan Grant",Subjects:"Paleontology, Geology"},{Name:"Dr. Ellie Sattler",Subjects:"Paleobotany"}]),a=v.Wp.book_new();v.Wp.book_append_sheet(a,e,"Teachers"),v._h(a,"Teacher_Data_Template.xlsx")},variant:"outline",size:"sm",className:"w-full sm:w-auto",children:[(0,s.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Template"]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t",children:[(0,s.jsxs)("h4",{className:"text-sm font-medium",children:["Teacher List (",e.length,")"]}),(0,s.jsxs)(r.$,{onClick:()=>{let t=e.length>0?Math.max(...e.map(e=>e.id))+1:1,s={id:t,Name:"New Teacher",Subjects:"Subjects"};a([...e,s]),n(t),c({...s})},size:"sm",variant:"outline",children:[(0,s.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Add Teacher"]})]}),(0,s.jsx)("div",{className:"max-h-60 overflow-y-auto w-full",children:(0,s.jsxs)(k.XI,{children:[(0,s.jsx)(k.A0,{className:"sticky top-0 bg-muted",children:(0,s.jsxs)(k.Hj,{children:[(0,s.jsx)(k.nd,{children:"Name"}),(0,s.jsx)(k.nd,{children:"Subjects"}),(0,s.jsx)(k.nd,{className:"text-right w-24",children:"Actions"})]})}),(0,s.jsx)(k.BF,{children:e.length>0?e.map(a=>(0,s.jsx)(k.Hj,{children:t===a.id?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.nA,{children:(0,s.jsx)(N.p,{value:i.Name,onChange:e=>g(e,"Name"),className:"h-8"})}),(0,s.jsx)(k.nA,{children:(0,s.jsx)(N.p,{value:i.Subjects,onChange:e=>g(e,"Subjects"),className:"h-8"})}),(0,s.jsx)(k.nA,{className:"text-right",children:(0,s.jsxs)("div",{className:"flex gap-1 justify-end",children:[(0,s.jsx)(r.$,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:p,children:(0,s.jsx)(S.A,{className:"h-4 w-4 text-green-600"})}),(0,s.jsx)(r.$,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:f,children:(0,s.jsx)(A.A,{className:"h-4 w-4 text-red-600"})})]})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.nA,{className:"font-medium",children:a.Name}),(0,s.jsx)(k.nA,{children:a.Subjects}),(0,s.jsx)(k.nA,{className:"text-right",children:(0,s.jsxs)("div",{className:"flex gap-1 justify-end",children:[(0,s.jsx)(r.$,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>{n(a.id),c({...a})},children:(0,s.jsx)(u.A,{className:"h-4 w-4"})}),(0,s.jsx)(r.$,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>{var t;return t=a.id,void(j(e.filter(e=>e.id!==t)),o({title:"Teacher entry deleted."}))},children:(0,s.jsx)(C.A,{className:"h-4 w-4"})})]})})]})},a.id)):(0,s.jsx)(k.Hj,{children:(0,s.jsx)(k.nA,{colSpan:3,className:"text-center text-muted-foreground py-8",children:"No teacher data yet. Upload an Excel file or add teachers manually."})})})]})})]})}var T=t(67812),D=t(39347),I=t(38162),F=t(5917),J=t(25016);let L=l.forwardRef((e,a)=>{let{className:t,...l}=e;return(0,s.jsx)(I.bL,{ref:a,className:(0,J.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...l,children:(0,s.jsx)(I.C1,{className:(0,J.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(F.A,{className:"h-4 w-4"})})})});L.displayName=I.bL.displayName;var R=t(90235);function $(){let[e,a]=(0,l.useState)(""),[t,n]=(0,l.useState)(!1),[i,c]=(0,l.useState)([]),[o,m]=(0,l.useState)(null),[h,x]=(0,l.useState)(""),{toast:j}=(0,b.dj)(),[f,p]=(0,l.useState)(null),g=e=>f?"".concat(f,"-").concat(e):null;(0,l.useEffect)(()=>{p(localStorage.getItem("schoolID"))},[]),(0,l.useEffect)(()=>{if(!f)return;let e=g("subjects");if(!e)return;let a=localStorage.getItem(e);if(a)try{let e=JSON.parse(a);if(Array.isArray(e)&&e.every(e=>"string"==typeof e)){let a=e.map(e=>({name:e,mandatory:!1}));v(a)}else c(e)}catch(e){console.error("Failed to parse subjects from localStorage",e),c([])}else c([])},[f]);let v=e=>{let a=g("subjects");a&&(c(e),localStorage.setItem(a,JSON.stringify(e)))},y=()=>{let s=e.trim();s&&!i.some(e=>e.name.toLowerCase()===s.toLowerCase())?(v([...i,{name:s,mandatory:t}]),a(""),n(!1),j({title:'Subject "'.concat(s,'" added.')})):s?j({title:"This subject already exists.",variant:"destructive"}):j({title:"Subject name cannot be empty.",variant:"destructive"})},w=()=>{m(null),x("")},C=()=>{let e=h.trim();return e?i.some(a=>a.name.toLowerCase()===e.toLowerCase())&&e.toLowerCase()!==(null==o?void 0:o.name.toLowerCase())?void j({title:"This subject already exists.",variant:"destructive"}):void(o&&(v(i.map(a=>a.name===o.name?{...a,name:e}:a)),w(),j({title:'Subject updated to "'.concat(e,'".')}))):void j({title:"Subject name cannot be empty.",variant:"destructive"})};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,s.jsxs)("div",{className:"flex-grow",children:[(0,s.jsx)(R.J,{htmlFor:"subject-input",children:"Subject Name"}),(0,s.jsx)(N.p,{id:"subject-input",placeholder:"e.g., Mathematics",value:e,onChange:e=>a(e.target.value),onKeyDown:e=>"Enter"===e.key&&y()})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 pb-2",children:[(0,s.jsx)(L,{id:"mandatory",checked:t,onCheckedChange:e=>n(e)}),(0,s.jsx)(R.J,{htmlFor:"mandatory",children:"Mandatory"})]}),(0,s.jsx)(r.$,{onClick:y,variant:"secondary",children:"Add"})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 pt-2 min-h-[2.5rem]",children:i.map((e,a)=>(0,s.jsx)("div",{children:(null==o?void 0:o.name)===e.name?(0,s.jsxs)("div",{className:"flex items-center gap-1.5 py-1 px-2.5 bg-secondary rounded-full",children:[(0,s.jsx)(N.p,{value:h,onChange:e=>x(e.target.value),className:"h-6 w-32 bg-background"}),(0,s.jsx)("button",{onClick:C,className:"rounded-full hover:bg-black/10 dark:hover:bg-white/10 p-0.5",children:(0,s.jsx)(S.A,{className:"h-4 w-4 text-green-600"})}),(0,s.jsx)("button",{onClick:w,className:"rounded-full hover:bg-black/10 dark:hover:bg-white/10 p-0.5",children:(0,s.jsx)(A.A,{className:"h-4 w-4 text-red-600"})})]}):(0,s.jsxs)(T.E,{variant:"secondary",className:"flex items-center gap-1.5 py-1 px-2.5 text-sm",children:[(0,s.jsx)("button",{onClick:()=>{v(i.map(a=>a.name===e.name?{...a,mandatory:!a.mandatory}:a))},"aria-label":"Toggle mandatory for ".concat(e.name),children:(0,s.jsx)(D.A,{className:"h-4 w-4 transition-colors ".concat(e.mandatory?"text-amber-500 fill-amber-500":"text-gray-400")})}),e.name,(0,s.jsx)("button",{onClick:()=>{m(e),x(e.name)},className:"rounded-full hover:bg-black/10 dark:hover:bg-white/10 p-0.5","aria-label":"Edit ".concat(e.name),children:(0,s.jsx)(u.A,{className:"h-3 w-3"})}),(0,s.jsx)("button",{onClick:()=>{v(i.filter(a=>a.name!==e.name)),j({title:'Subject "'.concat(e.name,'" removed.')})},className:"rounded-full hover:bg-black/10 dark:hover:bg-white/10 p-0.5","aria-label":"Remove ".concat(e.name),children:(0,s.jsx)(d.A,{className:"h-3 w-3"})})]})},"".concat(e.name,"-").concat(a)))})]})}var O=t(27346);let z=[{value:"monday",label:"Monday",num:1},{value:"tuesday",label:"Tuesday",num:2},{value:"wednesday",label:"Wednesday",num:3},{value:"thursday",label:"Thursday",num:4},{value:"friday",label:"Friday",num:5},{value:"saturday",label:"Saturday",num:6},{value:"sunday",label:"Sunday",num:7}];function B(){let[e,a]=(0,l.useState)(""),[t,i]=(0,l.useState)(""),[c,d]=(0,l.useState)(""),[o,m]=(0,l.useState)([]),[h,u]=(0,l.useState)(""),[x,j]=(0,l.useState)(""),[f,p]=(0,l.useState)(z),[g,v]=(0,l.useState)(""),[y,S]=(0,l.useState)(null),{toast:A}=(0,b.dj)(),k=(0,l.useMemo)(()=>f.reduce((e,a)=>(e[a.label]=a.num,e),{}),[f]),E=e=>y?"".concat(y,"-").concat(e):null;(0,l.useEffect)(()=>{S(localStorage.getItem("schoolID"))},[]),(0,l.useEffect)(()=>{if(!y)return;let e=E("scheduleSettings");if(!e)return;let t=localStorage.getItem(e);if(t)try{let{totalPeriods:e,startTime:s,workingDays:l,lunchBreakAfter:r,lunchBreakDuration:n,periodDuration:c,allDays:o}=JSON.parse(t);a(e||""),i(s||""),d(c||""),m(l||[]),u(r||""),j(n||""),o&&Array.isArray(o)&&o.length>0?p(o):p(z)}catch(e){console.error("Failed to parse settings",e)}else a(""),i(""),d(""),m([]),u(""),j(""),p(z)},[y]);let T=()=>{let e=g.trim();if(!e)return void A({title:"Day name cannot be empty.",variant:"destructive"});let a=e.toLowerCase().replace(/\s/g,"");if(f.some(e=>e.value===a))return void A({title:"This day already exists.",variant:"destructive"});let t={value:a,label:e,num:f.length>0?Math.max(...f.map(e=>e.num))+1:1};p([...f,t].sort((e,a)=>e.num-a.num)),v(""),A({title:'Day "'.concat(e,'" added.')})};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(R.J,{htmlFor:"totalPeriods",className:"text-xs",children:"Periods/Day"}),(0,s.jsx)(N.p,{id:"totalPeriods",type:"number",placeholder:"e.g., 8",value:e,onChange:e=>a(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(R.J,{htmlFor:"startTime",className:"text-xs",children:"Start Time"}),(0,s.jsx)(N.p,{id:"startTime",type:"time",value:t,onChange:e=>i(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(R.J,{htmlFor:"periodDuration",className:"text-xs",children:"Period Duration (min)"}),(0,s.jsx)(N.p,{id:"periodDuration",type:"number",placeholder:"e.g., 45",value:c,onChange:e=>d(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(R.J,{htmlFor:"lunchBreakAfter",className:"text-xs",children:"Lunch After Period"}),(0,s.jsx)(N.p,{id:"lunchBreakAfter",type:"number",placeholder:"e.g., 4",value:h,onChange:e=>u(e.target.value)})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)(R.J,{htmlFor:"lunchBreakDuration",className:"text-xs",children:"Lunch Duration (min)"}),(0,s.jsx)(N.p,{id:"lunchBreakDuration",type:"number",placeholder:"e.g., 30",value:x,onChange:e=>j(e.target.value)})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(R.J,{className:"text-xs d-block mb-2",children:"Working Days"}),(0,s.jsx)(n.Zp,{children:(0,s.jsxs)(n.Wu,{className:"p-2 space-y-2",children:[(0,s.jsx)(O.F,{className:"h-24",children:(0,s.jsx)("div",{className:"space-y-2 p-2",children:f.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(L,{id:e.value,checked:o.includes(e.label),onCheckedChange:()=>{var a;return a=e.label,void m(e=>(e.includes(a)?e.filter(e=>e!==a):[...e,a]).sort((e,a)=>(k[e]||0)-(k[a]||0)))}}),(0,s.jsx)(R.J,{htmlFor:e.value,className:"font-normal cursor-pointer",children:e.label})]}),(0,s.jsx)(r.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:a=>{a.stopPropagation();var t,s=e.value;let l=null==(t=f.find(e=>e.value===s))?void 0:t.label;p(e=>e.filter(e=>e.value!==s)),l&&m(e=>e.filter(e=>e!==l)),A({title:'Day "'.concat(l,'" removed.')})},children:(0,s.jsx)(C.A,{className:"h-4 w-4 text-destructive/70"})})]},e.value))})}),(0,s.jsxs)("div",{className:"flex gap-2 p-2 border-t",children:[(0,s.jsx)(N.p,{placeholder:"Add new day...",value:g,onChange:e=>v(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),T())}}),(0,s.jsx)(r.$,{variant:"secondary",size:"icon",onClick:T,children:(0,s.jsx)(w.A,{className:"h-4 w-4"})})]})]})})]}),(0,s.jsx)(r.$,{onClick:()=>{let a=E("scheduleSettings");a&&(parseInt(e)>0&&t&&o.length>0&&parseInt(h)>0&&parseInt(x)>0&&parseInt(c)>0?(localStorage.setItem(a,JSON.stringify({totalPeriods:e,startTime:t,workingDays:o,lunchBreakAfter:h,lunchBreakDuration:x,periodDuration:c,allDays:f})),A({title:"Schedule settings have been saved."})):A({title:"Please provide valid inputs for all fields.",variant:"destructive"}))},className:"w-full",variant:"secondary",children:"Save Schedule"})]})}var P=t(35299),Z=t(89559),_=t(20063),M=t(35646);let W=M.bL,U=M.l9,G=M.ZL,Y=l.forwardRef((e,a)=>{let{className:t,...l}=e;return(0,s.jsx)(M.hJ,{className:(0,J.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...l,ref:a})});Y.displayName=M.hJ.displayName;let H=l.forwardRef((e,a)=>{let{className:t,...l}=e;return(0,s.jsxs)(G,{children:[(0,s.jsx)(Y,{}),(0,s.jsx)(M.UC,{ref:a,className:(0,J.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l})]})});H.displayName=M.UC.displayName;let K=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,J.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...t})};K.displayName="AlertDialogHeader";let V=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,J.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};V.displayName="AlertDialogFooter";let X=l.forwardRef((e,a)=>{let{className:t,...l}=e;return(0,s.jsx)(M.hE,{ref:a,className:(0,J.cn)("text-lg font-semibold",t),...l})});X.displayName=M.hE.displayName;let q=l.forwardRef((e,a)=>{let{className:t,...l}=e;return(0,s.jsx)(M.VY,{ref:a,className:(0,J.cn)("text-sm text-muted-foreground",t),...l})});q.displayName=M.VY.displayName;let Q=l.forwardRef((e,a)=>{let{className:t,...l}=e;return(0,s.jsx)(M.rc,{ref:a,className:(0,J.cn)((0,r.r)(),t),...l})});Q.displayName=M.rc.displayName;let ee=l.forwardRef((e,a)=>{let{className:t,...l}=e;return(0,s.jsx)(M.ZD,{ref:a,className:(0,J.cn)((0,r.r)({variant:"outline"}),"mt-2 sm:mt-0",t),...l})});ee.displayName=M.ZD.displayName;let ea=e=>{let a=e.length,t,s=[...e];for(;0!==a;)t=Math.floor(Math.random()*a),a--,[s[a],s[t]]=[s[t],s[a]];return s};function et(e){let{isTimetableGenerated:a}=e,[t,n]=(0,l.useState)(!1),{toast:i}=(0,b.dj)(),c=(0,_.useRouter)(),[d,o]=(0,l.useState)(null);(0,l.useEffect)(()=>{o(localStorage.getItem("schoolID"))},[]);let m=async()=>{n(!0);let e="An unknown error occurred.";try{if(!d)throw Error("School ID not found. Please log in again.");let a="".concat(d,"-teacherData"),t="".concat(d,"-subjects"),s="".concat(d,"-scheduleSettings"),l="".concat(d,"-classesAndSections"),r="".concat(d,"-resolvedTimetable"),n=localStorage.getItem(a),o=localStorage.getItem(t),m=localStorage.getItem(s),h=localStorage.getItem(l);if(!n||!o||!m||!h)throw e="Please ensure teacher data, subjects, schedule settings, and class data are all set.",Error(e);let u=JSON.parse(n),x=JSON.parse(o),{totalPeriods:j,workingDays:f,lunchBreakAfter:p}=JSON.parse(m),g=JSON.parse(h);if(!j||!f||0===f.length||!p)throw e="Schedule settings are incomplete. Please check Timing and Days.",Error(e);let v=((e,a,t,s,l,r)=>{let n=l.flatMap(e=>e.sections.map(a=>"".concat(e.name," ").concat(a)));if(0===n.length||0===e.length||0===a.length)throw Error("Cannot generate timetable. Ensure classes, teachers, and subjects are added.");if(a.filter(e=>e.mandatory).map(e=>e.name),a.filter(e=>!e.mandatory).map(e=>e.name),0===a.length)throw Error("No subjects defined. Please add subjects.");let i=new Map;a.forEach(a=>{let t=e.filter(e=>e.Subjects.split(",").map(e=>e.trim().toLowerCase()).includes(a.name.toLowerCase())).map(e=>e.Name);t.length>0&&i.set(a.name,t)});let c={};e.forEach(e=>c[e.Name]=0);let d=[],o={};for(let e of s)for(let s of n){let l=ea(a.map(e=>e.name)),n=new Set;for(let h=1;h<=t;h++){let t=h<=r?h:h+1,u=!1,x=ea(l.filter(e=>!n.has(e)));for(let a of(0===x.length&&(x=ea(l)),x)){let l=ea(i.get(a)||[]).filter(a=>!o["".concat(a,"-").concat(e,"-").concat(t)]);if(l.length>0){l.sort((e,a)=>c[e]-c[a]);let r=l[0];d.push({day:e,period:t,class:s,subject:a,teacher:r}),o["".concat(r,"-").concat(e,"-").concat(t)]=!0,c[r]++,n.add(a),u=!0;break}}if(!u){var m;d.push({day:e,period:t,class:s,subject:(null==(m=a[0])?void 0:m.name)||"N/A",teacher:"Unassigned"})}}}for(let e of d)if("Unassigned"!==e.teacher){let a=d.filter(a=>a.teacher===e.teacher&&a.day===e.day&&a.period===e.period);if(a.length>1)for(let e=1;e<a.length;e++)a[e].teacher="Unassigned"}for(let e of s)for(let a of n)d.push({day:e,period:r+1,class:a,subject:"Lunch Break",teacher:"N/A"});return d})(u,x,parseInt(j,10),f,g,parseInt(p,10));if(0===v.length)throw e="Cannot create timetable. Check your inputs for teachers, subjects, and classes.",Error(e);localStorage.setItem(r,JSON.stringify(v)),window.dispatchEvent(new StorageEvent("storage",{key:r,newValue:JSON.stringify(v)})),i({title:"Timetable Generated!",description:"Redirecting you to the edit page..."}),c.push("/edit-timetable")}catch(a){i({title:"Generation Failed",description:a.message||e,variant:"destructive",duration:8e3})}finally{n(!1)}};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)(r.$,{onClick:m,disabled:t||a,size:"lg",className:"w-full text-lg font-bold tracking-wider",children:[t&&(0,s.jsx)(P.A,{className:"mr-2 h-4 w-4 animate-spin"}),t?"Generating...":a?"Timetable Already Exists":"GENERATE TIMETABLE"]}),a&&(0,s.jsxs)(W,{children:[(0,s.jsx)(U,{asChild:!0,children:(0,s.jsxs)(r.$,{variant:"destructive",className:"w-full",children:[(0,s.jsx)(Z.A,{className:"mr-2 h-4 w-4"}),"Force Regenerate Timetable"]})}),(0,s.jsxs)(H,{children:[(0,s.jsxs)(K,{children:[(0,s.jsx)(X,{children:"Are you sure?"}),(0,s.jsx)(q,{children:"This will delete your current timetable and generate a new one. This action cannot be undone."})]}),(0,s.jsxs)(V,{children:[(0,s.jsx)(ee,{children:"Cancel"}),(0,s.jsx)(Q,{onClick:m,children:"Yes, Regenerate"})]})]})]})]})}function es(){let[e,a]=(0,l.useState)(""),[t,i]=(0,l.useState)(""),[c,o]=(0,l.useState)([]),[m,h]=(0,l.useState)([]),{toast:u}=(0,b.dj)(),[x,j]=(0,l.useState)(null),f=e=>x?"".concat(x,"-").concat(e):null;(0,l.useEffect)(()=>{j(localStorage.getItem("schoolID"))},[]),(0,l.useEffect)(()=>{if(!x)return;let e=f("classesAndSections");if(!e)return;let a=localStorage.getItem(e);if(a)try{h(JSON.parse(a))}catch(e){console.error("Failed to parse classes from localStorage",e),h([])}else h([])},[x]);let p=e=>{let a=f("classesAndSections");a&&(h(e),localStorage.setItem(a,JSON.stringify(e)))},g=()=>{let e=t.trim();return e?c.map(e=>e.toLowerCase()).includes(e.toLowerCase())?void u({title:"This section has already been added.",variant:"destructive"}):void(o([...c,e]),i("")):void u({title:"Section name cannot be empty.",variant:"destructive"})};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-4 p-4 border rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(R.J,{htmlFor:"className",children:"Class Name"}),(0,s.jsx)(N.p,{id:"className",placeholder:"e.g., Grade 10",value:e,onChange:e=>a(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(R.J,{htmlFor:"sectionName",children:"Section Name"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(N.p,{id:"sectionName",placeholder:"e.g., A",value:t,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),g())}}),(0,s.jsx)(r.$,{onClick:g,variant:"outline",size:"icon","aria-label":"Add Section",children:(0,s.jsx)(w.A,{className:"h-4 w-4"})})]})]}),c.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(R.J,{children:"Sections to be added"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:c.map(e=>(0,s.jsxs)(T.E,{variant:"secondary",children:[e,(0,s.jsx)("button",{onClick:()=>{o(c.filter(a=>a!==e))},className:"ml-1.5 rounded-full hover:bg-black/10 dark:hover:bg-white/10 p-0.5","aria-label":"Remove ".concat(e),children:(0,s.jsx)(d.A,{className:"h-3 w-3"})})]},e))})]}),(0,s.jsxs)(r.$,{onClick:()=>{let t=e.trim();return t?0===c.length?void u({title:"Please add at least one section.",variant:"destructive"}):m.some(e=>e.name.toLowerCase()===t.toLowerCase())?void u({title:"This class name already exists.",variant:"destructive"}):void(p([...m,{id:new Date().toISOString(),name:t,sections:c}]),a(""),o([]),i(""),u({title:'Class "'.concat(t,'" added.')})):void u({title:"Class name cannot be empty.",variant:"destructive"})},variant:"secondary",className:"w-full",children:[(0,s.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Add Class"]})]}),(0,s.jsx)(O.F,{className:"h-40 w-full rounded-md border p-2",children:(0,s.jsx)("div",{className:"space-y-2",children:m.length>0?m.map(e=>(0,s.jsx)(n.Zp,{children:(0,s.jsxs)(n.Wu,{className:"p-2 flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold",children:e.name}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.sections.map(e=>(0,s.jsx)(T.E,{variant:"outline",children:e},e))})]}),(0,s.jsx)(r.$,{variant:"ghost",size:"icon",onClick:()=>(e=>{let a=m.find(a=>a.id===e);p(m.filter(a=>a.id!==e)),u({title:'Class "'.concat(null==a?void 0:a.name,'" removed.')})})(e.id),"aria-label":"Delete class ".concat(e.name),children:(0,s.jsx)(C.A,{className:"h-4 w-4 text-destructive"})})]})},e.id)):(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No classes added yet."})})})]})}var el=t(52619),er=t.n(el),en=t(79943),ei=t(32559);function ec(){let[e,a]=(0,l.useState)(!1),{schoolId:t,schoolName:v,logout:N,isLoading:b,isAdmin:y}=(0,en.A)(),w=(0,_.useRouter)(),[S,A]=(0,l.useState)(null),[C,k]=(0,l.useState)(!0),T=(0,l.useCallback)(e=>t?"".concat(t,"-").concat(e):null,[t]);(0,l.useEffect)(()=>{!b&&(y?w.push("/admin/dashboard"):t||w.push("/"))},[t,y,b,w]);let D=(0,l.useCallback)(()=>{if(!t)return;let e=T("resolvedTimetable");if(e)try{let t=localStorage.getItem(e),s=t?JSON.parse(t):[];a(Array.isArray(s)&&s.length>0)}catch(e){a(!1)}},[t,T]);return((0,l.useEffect)(()=>{D();let e=e=>{let a=T("resolvedTimetable");(e.key===a||null===e.key)&&D()};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[t,D,T]),(0,l.useEffect)(()=>{try{let e=localStorage.getItem("adminAnnouncement");if(e){let a=JSON.parse(e);localStorage.getItem("dismissedAnnouncementTimestamp")!==a.timestamp&&(A(a),k(!0))}}catch(e){console.error("Failed to parse announcement",e),A(null)}},[]),!b&&(y||t))?(0,s.jsxs)("div",{className:"min-h-screen bg-background text-foreground",children:[(0,s.jsx)("header",{className:"bg-card/80 backdrop-blur-lg border-b sticky top-0 z-40",children:(0,s.jsxs)("div",{className:"container mx-auto flex justify-between items-center h-16 px-4",children:[(0,s.jsxs)("div",{className:"text-lg font-bold text-foreground",children:[(0,s.jsx)("h1",{className:"text-xl font-bold text-foreground",children:v||"Dashboard"}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["School ID: ",t||"N/A"]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(r.$,{onClick:()=>N(),variant:"outline",size:"sm",children:[(0,s.jsx)(i.A,{className:"mr-2 h-4 w-4"})," Logout"]})})]})}),(0,s.jsxs)("main",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[S&&C&&(0,s.jsxs)(ei.Fc,{className:"mb-6 border-accent/50 relative bg-accent/10",children:[(0,s.jsx)(c.A,{className:"h-4 w-4 text-accent"}),(0,s.jsx)(ei.XL,{className:"font-bold text-accent",children:"Important Announcement"}),(0,s.jsx)(ei.TN,{children:S.message}),(0,s.jsxs)(r.$,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-6 w-6",onClick:()=>{if(S)try{localStorage.setItem("dismissedAnnouncementTimestamp",S.timestamp),k(!1)}catch(e){console.error("Failed to set dismissed timestamp",e)}},children:[(0,s.jsx)(d.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Dismiss"})]})]}),e&&(0,s.jsxs)(n.Zp,{className:"mb-8",children:[(0,s.jsxs)(n.aR,{children:[(0,s.jsx)(n.ZB,{children:"Timetable Ready"}),(0,s.jsx)(n.BT,{children:"Your timetable is generated. You can now view, edit or manage daily arrangements."})]}),(0,s.jsxs)(n.Wu,{className:"flex flex-wrap gap-2",children:[(0,s.jsx)(r.$,{asChild:!0,children:(0,s.jsxs)(er(),{href:"/preview",children:[(0,s.jsx)(o.A,{className:"mr-2 h-4 w-4"}),"Full Preview"]})}),(0,s.jsx)(r.$,{asChild:!0,variant:"outline",children:(0,s.jsxs)(er(),{href:"/teacher-timetable",children:[(0,s.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Teacher-wise"]})}),(0,s.jsx)(r.$,{asChild:!0,variant:"outline",children:(0,s.jsxs)(er(),{href:"/class-timetable",children:[(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"Class-wise"]})}),(0,s.jsx)(r.$,{asChild:!0,variant:"outline",children:(0,s.jsxs)(er(),{href:"/edit-timetable",children:[(0,s.jsx)(u.A,{className:"mr-2 h-4 w-4"}),"Edit Timetable"]})}),(0,s.jsx)(r.$,{asChild:!0,variant:"outline",children:(0,s.jsxs)(er(),{href:"/arrangement",children:[(0,s.jsx)(x.A,{className:"mr-2 h-4 w-4"}),"Arrangement"]})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-8",children:[(0,s.jsxs)(n.Zp,{children:[(0,s.jsxs)(n.aR,{children:[(0,s.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(j.A,{})," 1. Upload & Manage Teacher Data"]}),(0,s.jsx)(n.BT,{children:"Upload an Excel file with teacher names and subjects, or add them manually."})]}),(0,s.jsx)(n.Wu,{children:(0,s.jsx)(E,{})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,s.jsxs)(n.Zp,{children:[(0,s.jsx)(n.aR,{children:(0,s.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(f.A,{})," 2. Manage Subjects"]})}),(0,s.jsx)(n.Wu,{children:(0,s.jsx)($,{})})]}),(0,s.jsxs)(n.Zp,{children:[(0,s.jsx)(n.aR,{children:(0,s.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(p.A,{})," 3. Manage Classes & Sections"]})}),(0,s.jsx)(n.Wu,{children:(0,s.jsx)(es,{})})]})]})]}),(0,s.jsx)("div",{className:"lg:col-span-1 space-y-8",children:(0,s.jsxs)(n.Zp,{children:[(0,s.jsxs)(n.aR,{children:[(0,s.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(g.A,{})," 4. Timing and Days"]}),(0,s.jsx)(n.BT,{children:"Set up the daily schedule structure for your school."})]}),(0,s.jsx)(n.Wu,{children:(0,s.jsx)(B,{})})]})})]}),(0,s.jsx)("section",{className:"mt-8",children:(0,s.jsxs)(n.Zp,{className:"bg-primary/10 border-primary/20",children:[(0,s.jsxs)(n.aR,{children:[(0,s.jsx)(n.ZB,{className:"text-primary",children:"5. Generate Your Timetable"}),(0,s.jsx)(n.BT,{className:"text-muted-foreground",children:"Once all data is provided above, generate a conflict-free timetable."})]}),(0,s.jsx)(n.Wu,{children:(0,s.jsx)(et,{isTimetableGenerated:e})})]})})]})]}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,s.jsx)("p",{children:"Loading..."})})}}},e=>{e.O(0,[524,545,619,431,229,34,665,228,441,255,358],()=>e(e.s=80076)),_N_E=e.O()}]);