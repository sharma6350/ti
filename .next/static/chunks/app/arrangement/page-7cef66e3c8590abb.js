(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[657],{9732:(e,t,s)=>{Promise.resolve().then(s.bind(s,59713))},33789:(e,t,s)=>{"use strict";s.d(t,{p:()=>l});var a=s(95155),r=s(12115),n=s(25016);let l=r.forwardRef((e,t)=>{let{className:s,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...l})});l.displayName="Input"},55325:(e,t,s)=>{"use strict";s.d(t,{OY:()=>o,dz:()=>u});var a=s(95155),r=s(12115),n=s(3203),l=s(83101),i=s(25016);let c=(0,l.F)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),d=r.createContext({size:"default",variant:"default"}),o=r.forwardRef((e,t)=>{let{className:s,variant:r,size:l,children:c,...o}=e;return(0,a.jsx)(n.bL,{ref:t,className:(0,i.cn)("flex items-center justify-center gap-1",s),...o,children:(0,a.jsx)(d.Provider,{value:{variant:r,size:l},children:c})})});o.displayName=n.bL.displayName;let u=r.forwardRef((e,t)=>{let{className:s,children:l,variant:o,size:u,...h}=e,x=r.useContext(d);return(0,a.jsx)(n.q7,{ref:t,className:(0,i.cn)(c({variant:x.variant||o,size:x.size||u}),s),...h,children:l})});u.displayName=n.q7.displayName},59713:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>T});var a=s(95155),r=s(12115),n=s(97003),l=s(33789),i=s(83209),c=s(96633),d=s(54679),o=s(28171),u=s(35626),h=s(91169),x=s(20508),m=s(86651),p=s(42529),f=s(78874),g=s(49476),j=s(309),b=s(24722),v=s(89715),N=s(27346),y=s(55325),w=s(90235),S=s(25016),A=s(52619),C=s.n(A),k=s(55239),D=s(16109),I=s(47507);function T(){let[e,t]=(0,r.useState)([]),[s,A]=(0,r.useState)([]),[T,L]=(0,r.useState)([]),[O,B]=(0,r.useState)([]),[E,z]=(0,r.useState)(new Map),[F,P]=(0,r.useState)(null),[M,_]=(0,r.useState)(!1),[U,V]=(0,r.useState)(null),[J,$]=(0,r.useState)({subject:"",teacher:""}),[q,H]=(0,r.useState)(new Set),[R,W]=(0,r.useState)(""),{toast:Z}=(0,o.dj)(),[G,X]=(0,r.useState)(""),[Y,K]=(0,r.useState)(""),[Q,ee]=(0,r.useState)(""),[et,es]=(0,r.useState)(null),[ea,er]=(0,r.useState)(""),[en,el]=(0,r.useState)("class"),ei=(0,r.useCallback)(e=>G?"".concat(G,"-").concat(e):null,[G]);(0,r.useEffect)(()=>{let e=localStorage.getItem("schoolID"),t=localStorage.getItem("schoolName");e&&X(e),t&&K(t),ee(new Date().toLocaleDateString("en-GB"))},[]),(0,r.useEffect)(()=>{if(!G)return;let e=ei("teacherData");if(e){let t=localStorage.getItem(e);if(t)try{let e=JSON.parse(t),s=[...new Set(e.map(e=>e.Name))].sort();A(s)}catch(e){A([])}}let s=ei("subjects");if(s){let e=localStorage.getItem(s);if(e)try{let t=JSON.parse(e);L(t.map(e=>e.name).sort())}catch(e){L([])}}let a=ei("classesAndSections");if(a){let e=localStorage.getItem(a);if(e)try{let t=JSON.parse(e);B(t.flatMap(e=>e.sections.map(t=>"".concat(e.name," ").concat(t))).sort())}catch(e){B([])}}let r=ei("resolvedTimetable");if(r){let e=localStorage.getItem(r);if(e)try{t(JSON.parse(e))}catch(e){t([])}}let n=ei("scheduleSettings");if(n){let e=localStorage.getItem(n);if(e)try{let t=JSON.parse(e);if(P(t),z((e=>{let t=new Map;if(!e||!e.startTime||!e.periodDuration||!e.totalPeriods||!e.lunchBreakAfter||!e.lunchBreakDuration)return t;let{startTime:s,periodDuration:a,lunchBreakAfter:r,lunchBreakDuration:n,totalPeriods:l}=e;try{let[e,i]=s.split(":").map(Number);if(isNaN(e)||isNaN(i))return new Map;let c=new Date;c.setHours(e,i,0,0);let d=e=>e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}).replace(" ","").toLowerCase(),o=parseInt(r,10),u=parseInt(n,10),h=parseInt(a,10),x=parseInt(l,10);if(isNaN(o)||isNaN(u)||isNaN(h)||isNaN(x))return new Map;for(let e=1;e<=x+1;e++){let s=new Date(c.getTime());if(e===o+1){let a=new Date(s.getTime()+6e4*u);t.set(e,"".concat(d(s),"-").concat(d(a))),c=a}else{let a=new Date(s.getTime()+6e4*h);t.set(e,"".concat(d(s),"-").concat(d(a))),c=a}}}catch(e){return console.error("Error calculating timings:",e),new Map}return t})(t)),t.workingDays&&t.workingDays.length>0){let e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],s=t.workingDays.sort((t,s)=>e.indexOf(t)-e.indexOf(s));W(s[0])}}catch(e){P(null)}}},[G,ei]);let{periods:ec,relevantDays:ed,dailyTimetable:eo,availableTeachersForModal:eu,availableTeachersForPanel:eh,absentTeachersArray:ex,allTeachersForView:em}=(0,r.useMemo)(()=>{let t=Array.from(q),a=s.filter(e=>!q.has(e)),r=[...a],n=a.filter(e=>e.toLowerCase().includes(ea.toLowerCase())),l=[...s].sort();if(F&&R){let s=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],a=F.workingDays.sort((e,t)=>s.indexOf(e)-s.indexOf(t)),i=parseInt(F.totalPeriods,10);return F.lunchBreakAfter&&parseInt(F.lunchBreakAfter,10)>0&&i++,{periods:Array.from({length:i},(e,t)=>t+1),relevantDays:a,dailyTimetable:e.filter(e=>e.day===R),availableTeachersForModal:r,availableTeachersForPanel:n,absentTeachersArray:t,allTeachersForView:l}}return{periods:[],relevantDays:[],dailyTimetable:[],availableTeachersForModal:r,availableTeachersForPanel:n,absentTeachersArray:t,allTeachersForView:l}},[F,e,R,s,q,ea]),ep=e=>{ej(e.period)||(V(e),$({subject:e.subject,teacher:e.teacher}),_(!0))},ef=(e,t)=>eo.find(s=>s.class===e&&s.period===t),eg=(e,t)=>eo.find(s=>s.teacher===e&&s.period===t),ej=e=>null!=F&&!!F.lunchBreakAfter&&e===parseInt(F.lunchBreakAfter,10)+1,eb=e=>{if(F){let t=parseInt(F.lunchBreakAfter,10);if(isNaN(t))return e;if(e>t)return e-1}return e},ev=()=>{let e=[],t=[{text:"class"===en?"Class":"Teacher",bold:!0}];return ec.forEach(e=>t.push({text:"".concat(ej(e)?"Lunch":"P".concat(eb(e)),"\n").concat(E.get(e)||""),bold:!0})),e.push(t),("class"===en?O:em).forEach(t=>{let s=[{text:t,bold:!0}];ec.forEach(e=>{if(ej(e))s.push({text:"Lunch"});else{let a="class"===en?ef(t,e):eg(t,e);if(a){let e="Unassigned"===a.teacher,t=q.has(a.teacher),r="class"===en?"".concat(a.subject,"\n").concat(a.teacher):"".concat(a.subject,"\n").concat(a.class);s.push({text:r,bold:e,color:e||t?"FF0000":"000000"})}else s.push({text:"-"})}}),e.push(s)}),e},eN=(s,a)=>{s.preventDefault(),et&&((s,a)=>{if(ej(s.period))return;let r=e.find(e=>e.day===s.day&&e.period===s.period&&e.teacher===a&&"Unassigned"!==a&&e.class!==s.class);if(r)return Z({title:"Scheduling Conflict",description:"".concat(a," is already assigned to ").concat(r.class," during this period."),variant:"destructive"});t(e.map(e=>e.day===s.day&&e.period===s.period&&e.class===s.class?{...e,teacher:a}:e)),Z({title:"Arrangement updated temporarily."})})(a,et),es(null)};return(0,a.jsxs)("div",{className:"min-h-screen bg-background text-foreground p-2 sm:p-4 lg:p-6",children:[(0,a.jsx)("style",{children:"\n        @media print {\n          body {\n            background-color: #fff;\n          }\n          .no-print { \n            display: none !important; \n          }\n          #printable-area { \n            position: absolute; \n            left: 0; \n            top: 0; \n            width: 100%;\n            height: auto;\n            overflow: visible;\n          }\n          #printable-area * { \n            visibility: visible; \n          }\n          .printable-table {\n            font-size: 8px;\n          }\n          .printable-table th, .printable-table td {\n            padding: 2px;\n          }\n        }\n      "}),(0,a.jsxs)("main",{className:"w-full mx-auto",children:[(0,a.jsxs)("div",{id:"printable-area",children:[(0,a.jsx)(k.A,{schoolName:Y,schoolId:G}),(0,a.jsx)("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-4 no-print",children:(0,a.jsx)(n.$,{asChild:!0,variant:"outline",children:(0,a.jsxs)(C(),{href:"/dashboard",children:[(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]})})}),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,a.jsx)("div",{className:"flex-grow",children:(0,a.jsxs)(i.Zp,{children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(i.ZB,{children:"Daily Arrangement"}),(0,a.jsx)(i.BT,{children:"Select a day, mark teachers absent, and drag available teachers to fill slots. Changes are temporary."})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-semibold text-primary",children:R}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:Q})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex flex-col sm:flex-row gap-4 items-end",children:[(0,a.jsx)("div",{className:"w-full sm:w-auto",children:(0,a.jsxs)(I.l6,{value:R,onValueChange:W,children:[(0,a.jsx)(I.bq,{id:"day-select",className:"w-full sm:w-[180px]",children:(0,a.jsx)(I.yv,{placeholder:"Select a day"})}),(0,a.jsx)(I.gC,{children:ed.map(e=>(0,a.jsx)(I.eb,{value:e,children:e},e))})]})}),(0,a.jsxs)(y.OY,{type:"single",value:en,onValueChange:e=>{e&&el(e)},children:[(0,a.jsxs)(y.dz,{value:"class","aria-label":"Class View",children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4"})," Class View"]}),(0,a.jsxs)(y.dz,{value:"teacher","aria-label":"Teacher View",children:[(0,a.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Teacher View"]})]})]})]}),(0,a.jsx)(i.Wu,{children:0===eo.length?(0,a.jsx)("div",{className:"text-center py-10",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"No timetable data found for this day."})}):(0,a.jsx)("div",{className:"overflow-x-auto printable-table",children:"class"===en?(0,a.jsxs)(c.XI,{children:[(0,a.jsx)(c.A0,{children:(0,a.jsxs)(c.Hj,{children:[(0,a.jsx)(c.nd,{className:"min-w-[120px] p-1 text-xs font-bold text-foreground",children:"Class"}),ec.map(e=>(0,a.jsxs)(c.nd,{className:"text-center p-1 text-xs font-bold text-foreground",children:[(0,a.jsx)("div",{className:"whitespace-nowrap",children:ej(e)?"Lunch":"P".concat(eb(e))}),(0,a.jsx)("div",{className:"text-[10px] text-muted-foreground font-normal whitespace-nowrap",children:E.get(e)})]},e))]})}),(0,a.jsx)(c.BF,{children:O.map(e=>(0,a.jsxs)(c.Hj,{children:[(0,a.jsx)(c.nA,{className:"font-semibold sticky left-0 bg-card z-10 p-1 text-xs",children:e}),ec.map(t=>{let s=ef(e,t),r=s&&q.has(s.teacher);return(0,a.jsx)(c.nA,{className:(0,S.cn)("text-center p-1 border",r&&"bg-destructive/80 text-destructive-foreground",!ej(t)&&"cursor-pointer hover:bg-muted",et&&"border-dashed border-primary"),onClick:()=>s&&ep(s),onDragOver:e=>e.preventDefault(),onDrop:e=>s&&eN(e,s),children:ej(t)?(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"L"}):s?(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-xs leading-tight",children:s.subject}),(0,a.jsx)("p",{className:(0,S.cn)("text-[11px] leading-tight","Unassigned"===s.teacher?"text-destructive-foreground font-bold":"text-muted-foreground"),children:s.teacher})]}):(0,a.jsx)("span",{className:"text-muted-foreground",children:"-"})},"".concat(e,"-").concat(t))})]},e))})]}):(0,a.jsxs)(c.XI,{children:[(0,a.jsx)(c.A0,{children:(0,a.jsxs)(c.Hj,{children:[(0,a.jsx)(c.nd,{className:"min-w-[120px] p-1 text-xs font-bold text-foreground",children:"Teacher"}),ec.map(e=>(0,a.jsxs)(c.nd,{className:"text-center p-1 text-xs font-bold text-foreground",children:[(0,a.jsx)("div",{className:"whitespace-nowrap",children:ej(e)?"Lunch":"P".concat(eb(e))}),(0,a.jsx)("div",{className:"text-[10px] text-muted-foreground font-normal whitespace-nowrap",children:E.get(e)})]},e))]})}),(0,a.jsx)(c.BF,{children:em.map(e=>{let t=q.has(e);return(0,a.jsxs)(c.Hj,{className:(0,S.cn)(t&&"bg-destructive/30"),children:[(0,a.jsx)(c.nA,{className:"font-semibold sticky left-0 bg-card z-10 p-1 text-xs",children:e}),ec.map(s=>{let r=eg(e,s);return(0,a.jsx)(c.nA,{className:(0,S.cn)("text-center p-1 border",!ej(s)&&!t&&"cursor-pointer hover:bg-muted",et&&"border-dashed border-primary"),onClick:()=>r&&!t&&ep(r),onDragOver:e=>e.preventDefault(),onDrop:e=>r&&!t&&eN(e,r),children:ej(s)?(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"L"}):r?(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-xs leading-tight",children:r.subject}),(0,a.jsx)("p",{className:"text-[11px] text-muted-foreground leading-tight",children:r.class})]}):(0,a.jsx)("span",{className:"text-muted-foreground",children:"-"})},"".concat(e,"-").concat(s))})]},e)})})]})})})]})}),(0,a.jsx)("div",{className:"w-full lg:w-80 flex-shrink-0 no-print space-y-4",children:(0,a.jsxs)(i.Zp,{children:[(0,a.jsx)(i.aR,{className:"p-4",children:(0,a.jsx)(i.ZB,{className:"text-lg",children:"Arrangement Tools"})}),(0,a.jsxs)(i.Wu,{className:"p-2 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(m.A,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(l.p,{placeholder:"Search teachers...",className:"pl-8",value:ea,onChange:e=>er(e.target.value)})]}),(0,a.jsx)(N.F,{className:"h-48 mt-2 border rounded-md",children:(0,a.jsx)("div",{className:"space-y-1 p-2",children:s.filter(e=>e.toLowerCase().includes(ea.toLowerCase())).map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 rounded hover:bg-muted",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:e}),(0,a.jsxs)(n.$,{size:"sm",variant:q.has(e)?"secondary":"outline",onClick:()=>{H(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},children:[q.has(e)?(0,a.jsx)(p.A,{className:"h-4 w-4 text-green-600"}):(0,a.jsx)(f.A,{className:"h-4 w-4 text-destructive"}),(0,a.jsx)("span",{className:"ml-2",children:q.has(e)?"Absent":"Present"})]})]},e))})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(w.J,{children:"Available for Substitution"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"Drag a teacher onto a slot to substitute."}),(0,a.jsx)(N.F,{className:"h-48 border rounded-md",children:(0,a.jsx)("div",{className:"space-y-1 p-2",children:["Unassigned",...eh].map(e=>(0,a.jsxs)("div",{draggable:!0,onDragStart:()=>{es(e)},className:"flex items-center p-2 border rounded-md cursor-grab active:cursor-grabbing bg-secondary hover:bg-muted",children:[(0,a.jsx)(g.A,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:e})]},e))})})]})]})]})})]})]}),eo.length>0&&(0,a.jsxs)("div",{className:"mt-6 flex flex-col sm:flex-row justify-center gap-4 no-print",children:[(0,a.jsxs)(n.$,{onClick:()=>{window.print()},variant:"outline",children:[(0,a.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Print"]}),(0,a.jsxs)(n.$,{onClick:()=>{let e=ev().map(e=>e.map(e=>e.text));(0,D.b)(e,"".concat(Y,"_Arrangement_").concat(R))},variant:"outline",children:[(0,a.jsx)(b.A,{className:"mr-2 h-4 w-4"})," Export to Excel"]}),(0,a.jsxs)(n.$,{onClick:()=>{let e=ev();(0,D.U)(e,"".concat(Y,"_Arrangement_").concat(R))},variant:"outline",children:[(0,a.jsx)(v.A,{className:"mr-2 h-4 w-4"})," Export to PDF"]})]})]}),(0,a.jsx)(d.lG,{open:M,onOpenChange:_,children:(0,a.jsxs)(d.Cf,{children:[(0,a.jsxs)(d.c7,{children:[(0,a.jsx)(d.L3,{children:"Make Arrangement"}),(0,a.jsxs)(d.rr,{children:["Assign a new teacher or subject for ",null==U?void 0:U.class," during Period ",U?eb(U.period):""," on ",null==U?void 0:U.day,"."]})]}),U&&(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(w.J,{htmlFor:"subject-select-modal",className:"text-right",children:"Subject"}),(0,a.jsxs)(I.l6,{value:J.subject,onValueChange:e=>$(t=>({...t,subject:e})),children:[(0,a.jsx)(I.bq,{className:"col-span-3",children:(0,a.jsx)(I.yv,{})}),(0,a.jsx)(I.gC,{children:T.map(e=>(0,a.jsx)(I.eb,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(w.J,{htmlFor:"teacher-select-modal",className:"text-right",children:"Available Teacher"}),(0,a.jsxs)(I.l6,{value:J.teacher,onValueChange:e=>$(t=>({...t,teacher:e})),children:[(0,a.jsx)(I.bq,{className:"col-span-3",children:(0,a.jsx)(I.yv,{})}),(0,a.jsxs)(I.gC,{children:[(0,a.jsx)(I.eb,{value:"Unassigned",children:"Unassigned"}),eu.map(e=>(0,a.jsx)(I.eb,{value:e,children:e},e))]})]})]})]}),(0,a.jsxs)(d.Es,{children:[(0,a.jsx)(n.$,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),(0,a.jsx)(n.$,{onClick:()=>{if(!U||!J.teacher||!J.subject)return;let s=e.find(e=>e.day===U.day&&e.period===U.period&&e.teacher===J.teacher&&"Unassigned"!==J.teacher&&e.class!==U.class);if(s)return void Z({title:"Scheduling Conflict",description:"".concat(J.teacher," is already assigned to ").concat(s.class," during this period."),variant:"destructive"});t(e.map(e=>e.day===U.day&&e.period===U.period&&e.class===U.class?{...e,subject:J.subject,teacher:J.teacher}:e)),Z({title:"Arrangement updated temporarily."}),_(!1),V(null)},children:"Save Arrangement"})]})]})})]})}}},e=>{e.O(0,[524,930,33,545,619,431,904,229,972,34,896,323,435,441,255,358],()=>e(e.s=9732)),_N_E=e.O()}]);